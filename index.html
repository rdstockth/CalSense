<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ñ‡πà‡∏≤‡∏ä‡∏î‡πÄ‡∏ä‡∏¢ UUC</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            padding: 40px;
            max-width: 1400px;
            margin: 0 auto;
        }

        h1 {
            color: #667eea;
            text-align: center;
            margin-bottom: 10px;
            font-size: 28px;
        }

        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
            font-size: 14px;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .tab {
            padding: 10px 20px;
            background: #f0f0f0;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s;
        }

        .tab:hover {
            background: #e0e0e0;
        }

        .tab.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .section {
            margin-bottom: 30px;
        }

        .section-title {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            font-weight: 600;
            font-size: 16px;
        }

        .calibration-points {
            display: grid;
            gap: 20px;
        }

        .point-group {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 12px;
            border-left: 4px solid #667eea;
        }

        .point-title {
            font-weight: 600;
            color: #333;
            margin-bottom: 15px;
            font-size: 15px;
        }

        .input-row {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
        }

        .input-group {
            margin-bottom: 0;
        }

        label {
            display: block;
            color: #555;
            font-weight: 500;
            margin-bottom: 6px;
            font-size: 13px;
        }

        input {
            width: 100%;
            padding: 10px 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s;
        }

        input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        input[readonly] {
            background: #f0f0f0;
        }

        .locations-table {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        thead {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        th {
            padding: 15px;
            text-align: left;
            font-weight: 600;
            font-size: 14px;
        }

        td {
            padding: 12px 15px;
            border-bottom: 1px solid #e0e0e0;
            font-size: 13px;
        }

        tbody tr:hover {
            background: #f8f9fa;
        }

        td input {
            padding: 8px 10px;
            font-size: 13px;
        }

        .btn-calculate-all {
            width: 100%;
            padding: 14px;
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            margin-top: 20px;
        }

        .btn-calculate-all:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(40, 167, 69, 0.4);
        }

        .btn-export {
            padding: 10px 20px;
            background: linear-gradient(135deg, #17a2b8 0%, #138496 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 10px;
        }

        .btn-export:hover {
            opacity: 0.9;
        }

        .formula-display {
            background: #e3f2fd;
            border-left: 4px solid #2196f3;
            padding: 15px;
            margin: 20px 0;
            border-radius: 8px;
            font-size: 13px;
            line-height: 1.6;
        }

        .formula-display pre {
            background: #f5f5f5;
            padding: 10px;
            border-radius: 5px;
            overflow-x: auto;
            font-size: 12px;
            margin: 10px 0;
        }

        .highlight {
            background: #fff3cd;
            animation: highlight 1s ease;
        }

        @keyframes highlight {
            0% { background: #fff3cd; }
            100% { background: transparent; }
        }

        @media (max-width: 768px) {
            .input-row {
                grid-template-columns: 1fr;
            }
            
            table {
                font-size: 12px;
            }
            
            th, td {
                padding: 8px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üå°Ô∏è ‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ñ‡πà‡∏≤‡∏ä‡∏î‡πÄ‡∏ä‡∏¢ UUC</h1>
        <p class="subtitle">Under Uncertainty of Calibration - Sensor Location Management</p>

        <div class="tabs">
            <button class="tab active" onclick="switchTab('calibration')">‚öôÔ∏è ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Calibration</button>
            <button class="tab" onclick="switchTab('calculation')">üìä ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ï‡∏≤‡∏° Location</button>
        </div>

        <!-- Tab: Calibration Setup -->
        <div id="calibration" class="tab-content active">
            <div class="section">
                <div class="section-title">üìä ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Calibration Points (3 ‡∏à‡∏∏‡∏î)</div>
                
                <div class="calibration-points">
                    <div class="point-group">
                        <div class="point-title">‡∏à‡∏∏‡∏î‡∏ó‡∏µ‡πà 1 (‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥‡∏ï‡πà‡∏≥)</div>
                        <div class="input-row">
                            <div class="input-group">
                                <label>Mean UUC (¬∞C)</label>
                                <input type="number" id="mean1" step="0.001" value="-14.7">
                            </div>
                            <div class="input-group">
                                <label>Standard (¬∞C)</label>
                                <input type="number" id="std1" step="0.001" value="-14.942">
                            </div>
                            <div class="input-group">
                                <label>Error</label>
                                <input type="number" id="err1" step="0.001" value="0.242" readonly>
                            </div>
                        </div>
                    </div>

                    <div class="point-group">
                        <div class="point-title">‡∏à‡∏∏‡∏î‡∏ó‡∏µ‡πà 2 (‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥‡∏Å‡∏•‡∏≤‡∏á)</div>
                        <div class="input-row">
                            <div class="input-group">
                                <label>Mean UUC (¬∞C)</label>
                                <input type="number" id="mean2" step="0.001" value="25.2">
                            </div>
                            <div class="input-group">
                                <label>Standard (¬∞C)</label>
                                <input type="number" id="std2" step="0.001" value="25.030">
                            </div>
                            <div class="input-group">
                                <label>Error</label>
                                <input type="number" id="err2" step="0.001" value="0.170" readonly>
                            </div>
                        </div>
                    </div>

                    <div class="point-group">
                        <div class="point-title">‡∏à‡∏∏‡∏î‡∏ó‡∏µ‡πà 3 (‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥‡∏™‡∏π‡∏á)</div>
                        <div class="input-row">
                            <div class="input-group">
                                <label>Mean UUC (¬∞C)</label>
                                <input type="number" id="mean3" step="0.001" value="34.9">
                            </div>
                            <div class="input-group">
                                <label>Standard (¬∞C)</label>
                                <input type="number" id="std3" step="0.001" value="35.028">
                            </div>
                            <div class="input-group">
                                <label>Error</label>
                                <input type="number" id="err3" step="0.001" value="-0.128" readonly>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="formula-display" id="formulaDisplay">
                    <strong>üìê ‡∏™‡∏°‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì (Polynomial Form):</strong><br>
                    Error = a + bT + cT¬≤<br>
                    Standard Value = Mean of UUC ‚àí Error
                </div>

                <div class="formula-display" id="lagrangeDisplay">
                    <strong>üìê ‡∏™‡∏°‡∏Å‡∏≤‡∏£ Lagrange Polynomial ‡πÅ‡∏ö‡∏ö‡πÄ‡∏ï‡πá‡∏° (Interpolation ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö 3 ‡∏à‡∏∏‡∏î):</strong><br>
                    <em>‡∏™‡∏°‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏Ñ‡πà‡∏≤ Error ‡∏ó‡∏µ‡πà‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥ T ‡πÉ‡∏î‡πÜ ‡πÇ‡∏î‡∏¢‡∏ú‡πà‡∏≤‡∏ô‡∏à‡∏∏‡∏î calibration ‡∏ó‡∏±‡πâ‡∏á 3 ‡∏à‡∏∏‡∏î (x‚ÇÅ, y‚ÇÅ), (x‚ÇÇ, y‚ÇÇ), (x‚ÇÉ, y‚ÇÉ)<br>
                    ‡πÇ‡∏î‡∏¢‡∏ó‡∏µ‡πà x = Mean UUC (¬∞C), y = Error (¬∞C)</em><br><br>
                    
                    <strong>Error(T) = y‚ÇÅ ‚ãÖ L‚ÇÅ(T) + y‚ÇÇ ‚ãÖ L‚ÇÇ(T) + y‚ÇÉ ‚ãÖ L‚ÇÉ(T)</strong><br><br>
                    
                    <strong>‡∏ê‡∏≤‡∏ô (Basis Polynomials):</strong><br>
                    L‚ÇÅ(T) = <span id="L1_num"></span> / <span id="L1_den"></span> = \frac{(T - x‚ÇÇ)(T - x‚ÇÉ)}{(x‚ÇÅ - x‚ÇÇ)(x‚ÇÅ - x‚ÇÉ)}<br>
                    L‚ÇÇ(T) = <span id="L2_num"></span> / <span id="L2_den"></span> = \frac{(T - x‚ÇÅ)(T - x‚ÇÉ)}{(x‚ÇÇ - x‚ÇÅ)(x‚ÇÇ - x‚ÇÉ)}<br>
                    L‚ÇÉ(T) = <span id="L3_num"></span> / <span id="L3_den"></span> = \frac{(T - x‚ÇÅ)(T - x‚ÇÇ)}{(x‚ÇÉ - x‚ÇÅ)(x‚ÇÉ - x‚ÇÇ)}<br><br>
                    
                    <pre id="fullFormula" style="font-family: monospace; white-space: pre-wrap;">
Error(T) = err‚ÇÅ √ó [(T - mean‚ÇÇ)(T - mean‚ÇÉ) / (mean‚ÇÅ - mean‚ÇÇ)(mean‚ÇÅ - mean‚ÇÉ)] 
         + err‚ÇÇ √ó [(T - mean‚ÇÅ)(T - mean‚ÇÉ) / (mean‚ÇÇ - mean‚ÇÅ)(mean‚ÇÇ - mean‚ÇÉ)] 
         + err‚ÇÉ √ó [(T - mean‚ÇÅ)(T - mean‚ÇÇ) / (mean‚ÇÉ - mean‚ÇÅ)(mean‚ÇÉ - mean‚ÇÇ)]

‡∏Ñ‡πà‡∏≤‡∏´‡∏•‡∏±‡∏á‡∏õ‡∏£‡∏±‡∏ö (Standard Value) = T - Error(T)
                    </pre>
                    
                    <em><strong>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏:</strong> ‡∏™‡∏°‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô polynomial ‡∏£‡∏∞‡∏î‡∏±‡∏ö 2 (quadratic) ‡∏ó‡∏µ‡πà‡∏ú‡πà‡∏≤‡∏ô‡∏à‡∏∏‡∏î‡∏ó‡∏±‡πâ‡∏á 3 ‡πÇ‡∏î‡∏¢‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ ‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏≤‡∏Å Lagrange interpolation ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö n+1 ‡∏à‡∏∏‡∏î‡πÉ‡∏´‡πâ polynomial ‡∏£‡∏∞‡∏î‡∏±‡∏ö n.</em>
                </div>
            </div>
        </div>

        <!-- Tab: Calculation by Location -->
        <div id="calculation" class="tab-content">
            <div class="section">
                <div class="section-title">üìç ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ñ‡πà‡∏≤ Adjustment ‡πÅ‡∏¢‡∏Å‡∏ï‡∏≤‡∏° Sensor Location</div>
                
                <div style="background: #e8f5e9; padding: 15px; border-radius: 10px; margin-bottom: 20px; border-left: 4px solid #4caf50;">
                    <strong>üìù ‡∏ß‡∏¥‡∏ò‡∏µ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô:</strong><br>
                    1. ‡∏Å‡∏£‡∏≠‡∏Å <strong>"‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏ß‡∏±‡∏î‡πÑ‡∏î‡πâ"</strong> ‡∏à‡∏≤‡∏Å‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡∏ß‡∏±‡∏î<br>
                    2. ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì <strong>"Adjustment"</strong> (‡∏Ñ‡πà‡∏≤‡∏ä‡∏î‡πÄ‡∏ä‡∏¢) ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥<br>
                    3. ‡πÅ‡∏™‡∏î‡∏á <strong>"‡∏Ñ‡πà‡∏≤‡∏´‡∏•‡∏±‡∏á Adjust"</strong> (‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡πÅ‡∏ó‡πâ‡∏à‡∏£‡∏¥‡∏á) = ‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏ß‡∏±‡∏î‡πÑ‡∏î‡πâ - Adjustment
                </div>
                
                <div class="locations-table">
                    <table id="locationsTable">
                        <thead>
                            <tr>
                                <th style="width: 5%;">#</th>
                                <th style="width: 30%;">Sensor Location</th>
                                <th style="width: 20%;">‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏ß‡∏±‡∏î‡πÑ‡∏î‡πâ (¬∞C)</th>
                                <th style="width: 22.5%;">Adjustment</th>
                                <th style="width: 22.5%;">‡∏Ñ‡πà‡∏≤‡∏´‡∏•‡∏±‡∏á Adjust (¬∞C)</th>
                            </tr>
                        </thead>
                        <tbody id="locationsBody">
                        </tbody>
                    </table>
                </div>

                <button class="btn-calculate-all" onclick="calculateAll()">üîÑ ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
                <button class="btn-export" onclick="exportToCSV()">üì• ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î CSV</button>
            </div>
        </div>
    </div>

    <script>
        const locations = [
            "Coating room S1",
            "Coating room S2",
            "PCM high index S1",
            "PCM high index S2",
            "Clean room S1",
            "Clean room S2",
            "Casting area",
            "PMG room",
            "Server room",
            "Mixing room 1.5",
            "Monomer Stock 1.6",
            "Monomer Stock PCM",
            "Monomer Stock 1.5",
            "Ring production",
            "Mixing room 1.6",
            "Clean room S1",
            "Clean room S2",
            "Casting area",
            "Polymerization area",
            "Product cleaning area",
            "Mould cleaning area",
            "Color check room",
            "Qc area",
            "Server room"
        ];

        // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á
        function initializeTable() {
            const tbody = document.getElementById('locationsBody');
            tbody.innerHTML = '';
            
            locations.forEach((location, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td><strong>${location}</strong></td>
                    <td><input type="number" step="0.01" id="measured_${index}" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏ß‡∏±‡∏î‡πÑ‡∏î‡πâ" onchange="calculateSingle(${index})"></td>
                    <td><input type="number" step="0.001" id="adjustment_${index}" readonly style="background: #fff3cd; font-weight: 600;"></td>
                    <td><input type="number" step="0.001" id="adjusted_${index}" readonly style="background: #d4edda; font-weight: 600;"></td>
                `;
                tbody.appendChild(row);
            });
        }

        // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì Error ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
        function updateError(pointNum) {
            const mean = parseFloat(document.getElementById('mean' + pointNum).value);
            const std = parseFloat(document.getElementById('std' + pointNum).value);
            if (!isNaN(mean) && !isNaN(std)) {
                const error = mean - std;
                document.getElementById('err' + pointNum).value = error.toFixed(3);
                updateFormula();
                updateLagrangeFormula();
            }
        }

        // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏°‡∏Å‡∏≤‡∏£ Polynomial (‡πÄ‡∏î‡∏¥‡∏°)
        function updateFormula() {
            const x1 = parseFloat(document.getElementById('mean1').value);
            const y1 = parseFloat(document.getElementById('err1').value);
            const x2 = parseFloat(document.getElementById('mean2').value);
            const y2 = parseFloat(document.getElementById('err2').value);
            const x3 = parseFloat(document.getElementById('mean3').value);
            const y3 = parseFloat(document.getElementById('err3').value);

            if (!isNaN(x1) && !isNaN(y1) && !isNaN(x2) && !isNaN(y2) && !isNaN(x3) && !isNaN(y3)) {
                const coeffs = getPolynomialCoefficients(x1, y1, x2, y2, x3, y3);
                document.getElementById('formulaDisplay').innerHTML = `
                    <strong>üìê ‡∏™‡∏°‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì (Polynomial Form):</strong><br>
                    Error = ${coeffs.a.toFixed(8)} ${coeffs.b >= 0 ? '+' : ''}${coeffs.b.toFixed(8)}T ${coeffs.c >= 0 ? '+' : ''}${coeffs.c.toFixed(8)}T¬≤<br>
                    Standard Value = Mean of UUC ‚àí Error
                `;
            }
        }

        // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏°‡∏Å‡∏≤‡∏£ Lagrange ‡πÅ‡∏ö‡∏ö‡πÄ‡∏ï‡πá‡∏°
        function updateLagrangeFormula() {
            const x1 = parseFloat(document.getElementById('mean1').value);
            const y1 = parseFloat(document.getElementById('err1').value);
            const x2 = parseFloat(document.getElementById('mean2').value);
            const y2 = parseFloat(document.getElementById('err2').value);
            const x3 = parseFloat(document.getElementById('mean3').value);
            const y3 = parseFloat(document.getElementById('err3').value);

            if (!isNaN(x1) && !isNaN(y1) && !isNaN(x2) && !isNaN(y2) && !isNaN(x3) && !isNaN(y3)) {
                // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì denominator ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö L1, L2, L3
                const L1_den = (x1 - x2) * (x1 - x3);
                const L2_den = (x2 - x1) * (x2 - x3);
                const L3_den = (x3 - x1) * (x3 - x2);

                // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó spans ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö numerators (‡πÅ‡∏ï‡πà‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏≤‡∏Å‡πÄ‡∏õ‡πá‡∏ô symbolic, ‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏õ‡πá‡∏ô text)
                document.getElementById('L1_num').textContent = `(T - ${x2.toFixed(3)})(T - ${x3.toFixed(3)})`;
                document.getElementById('L1_den').textContent = `(${x1.toFixed(3)} - ${x2.toFixed(3)})( ${x1.toFixed(3)} - ${x3.toFixed(3)}) = ${L1_den.toFixed(6)}`;

                document.getElementById('L2_num').textContent = `(T - ${x1.toFixed(3)})(T - ${x3.toFixed(3)})`;
                document.getElementById('L2_den').textContent = `(${x2.toFixed(3)} - ${x1.toFixed(3)})( ${x2.toFixed(3)} - ${x3.toFixed(3)}) = ${L2_den.toFixed(6)}`;

                document.getElementById('L3_num').textContent = `(T - ${x1.toFixed(3)})(T - ${x2.toFixed(3)})`;
                document.getElementById('L3_den').textContent = `(${x3.toFixed(3)} - ${x1.toFixed(3)})( ${x3.toFixed(3)} - ${x2.toFixed(3)}) = ${L3_den.toFixed(6)}`;

                // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó full formula pre
                const fullFormula = `Error(T) = ${y1.toFixed(3)} √ó [(T - ${x2.toFixed(3)})(T - ${x3.toFixed(3)}) / (${x1.toFixed(3)} - ${x2.toFixed(3)})( ${x1.toFixed(3)} - ${x3.toFixed(3)})] 
         + ${y2.toFixed(3)} √ó [(T - ${x1.toFixed(3)})(T - ${x3.toFixed(3)}) / (${x2.toFixed(3)} - ${x1.toFixed(3)})( ${x2.toFixed(3)} - ${x3.toFixed(3)})] 
         + ${y3.toFixed(3)} √ó [(T - ${x1.toFixed(3)})(T - ${x2.toFixed(3)}) / (${x3.toFixed(3)} - ${x1.toFixed(3)})( ${x3.toFixed(3)} - ${x2.toFixed(3)})]

‡∏Ñ‡πà‡∏≤‡∏´‡∏•‡∏±‡∏á‡∏õ‡∏£‡∏±‡∏ö (Standard Value) = T - Error(T)`;
                document.getElementById('fullFormula').textContent = fullFormula;
            }
        }

        // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ñ‡πà‡∏≤‡∏™‡∏±‡∏°‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå Polynomial (‡πÄ‡∏î‡∏¥‡∏° ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö polynomial form)
        function getPolynomialCoefficients(x1, y1, x2, y2, x3, y3) {
            const denom = (x1 - x2) * (x1 - x3) * (x2 - x3);
            const c = (y1 * (x2 - x3) + y2 * (x3 - x1) + y3 * (x1 - x2)) / denom;
            const b = (y1 * (x3*x3 - x2*x2) + y2 * (x1*x1 - x3*x3) + y3 * (x2*x2 - x1*x1)) / denom;
            const a = y1 - b * x1 - c * x1 * x1;
            return { a, b, c };
        }

        // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ñ‡πà‡∏≤ Error ‡∏î‡πâ‡∏ß‡∏¢ Lagrange Interpolation (‡πÄ‡∏î‡∏¥‡∏°)
        function calculateError(T, x1, y1, x2, y2, x3, y3) {
            const L1 = ((T - x2) * (T - x3)) / ((x1 - x2) * (x1 - x3));
            const L2 = ((T - x1) * (T - x3)) / ((x2 - x1) * (x2 - x3));
            const L3 = ((T - x1) * (T - x2)) / ((x3 - x1) * (x3 - x2));
            return y1 * L1 + y2 * L2 + y3 * L3;
        }

        // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
        function calculateSingle(index) {
            const x1 = parseFloat(document.getElementById('mean1').value);
            const y1 = parseFloat(document.getElementById('err1').value);
            const x2 = parseFloat(document.getElementById('mean2').value);
            const y2 = parseFloat(document.getElementById('err2').value);
            const x3 = parseFloat(document.getElementById('mean3').value);
            const y3 = parseFloat(document.getElementById('err3').value);

            if (isNaN(x1) || isNaN(y1) || isNaN(x2) || isNaN(y2) || isNaN(x3) || isNaN(y3)) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Calibration Points ‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô‡πÉ‡∏ô‡πÅ‡∏ó‡πá‡∏ö "‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Calibration"');
                return;
            }

            const measured = parseFloat(document.getElementById(`measured_${index}`).value);
            
            if (!isNaN(measured)) {
                const adjustment = calculateError(measured, x1, y1, x2, y2, x3, y3);
                const adjusted = measured - adjustment;
                
                document.getElementById(`adjustment_${index}`).value = adjustment.toFixed(3);
                document.getElementById(`adjusted_${index}`).value = adjusted.toFixed(3);
                
                // Highlight effect
                document.getElementById(`adjusted_${index}`).parentElement.classList.add('highlight');
                setTimeout(() => {
                    document.getElementById(`adjusted_${index}`).parentElement.classList.remove('highlight');
                }, 1000);
            }
        }

        // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
        function calculateAll() {
            const x1 = parseFloat(document.getElementById('mean1').value);
            const y1 = parseFloat(document.getElementById('err1').value);
            const x2 = parseFloat(document.getElementById('mean2').value);
            const y2 = parseFloat(document.getElementById('err2').value);
            const x3 = parseFloat(document.getElementById('mean3').value);
            const y3 = parseFloat(document.getElementById('err3').value);

            if (isNaN(x1) || isNaN(y1) || isNaN(x2) || isNaN(y2) || isNaN(x3) || isNaN(y3)) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Calibration Points ‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô‡πÉ‡∏ô‡πÅ‡∏ó‡πá‡∏ö "‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Calibration"');
                return;
            }

            let calculated = 0;
            locations.forEach((location, index) => {
                const measured = parseFloat(document.getElementById(`measured_${index}`).value);
                
                if (!isNaN(measured)) {
                    const adjustment = calculateError(measured, x1, y1, x2, y2, x3, y3);
                    const adjusted = measured - adjustment;
                    
                    document.getElementById(`adjustment_${index}`).value = adjustment.toFixed(3);
                    document.getElementById(`adjusted_${index}`).value = adjusted.toFixed(3);
                    
                    // Highlight effect
                    document.getElementById(`adjusted_${index}`).parentElement.classList.add('highlight');
                    setTimeout(() => {
                        document.getElementById(`adjusted_${index}`).parentElement.classList.remove('highlight');
                    }, 1000);
                    
                    calculated++;
                }
            });

            if (calculated === 0) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏ß‡∏±‡∏î‡πÑ‡∏î‡πâ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á');
            } else {
                alert(`‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô! ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô ${calculated} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`);
            }
        }

        // Export to CSV
        function exportToCSV() {
            let csv = 'No,Sensor Location,‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏ß‡∏±‡∏î‡πÑ‡∏î‡πâ (¬∞C),Adjustment,‡∏Ñ‡πà‡∏≤‡∏´‡∏•‡∏±‡∏á Adjust (¬∞C)\n';
            
            locations.forEach((location, index) => {
                const measured = document.getElementById(`measured_${index}`).value || '';
                const adjustment = document.getElementById(`adjustment_${index}`).value || '';
                const adjusted = document.getElementById(`adjusted_${index}`).value || '';
                csv += `${index + 1},"${location}",${measured},${adjustment},${adjusted}\n`;
            });

            const blob = new Blob(['\uFEFF' + csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', 'UUC_Adjustment_Results.csv');
            link.click();
        }

        // Switch tabs
        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tabName).classList.add('active');
        }

        // Event listeners
        for (let i = 1; i <= 3; i++) {
            document.getElementById('mean' + i).addEventListener('input', () => updateError(i));
            document.getElementById('std' + i).addEventListener('input', () => updateError(i));
        }

        // Initialize
        initializeTable();
        updateError(1);
        updateError(2);
        updateError(3);
        updateFormula();
        updateLagrangeFormula();
    </script>
</body>
</html>